{"version":3,"sources":["../src/ptab.js"],"names":["require","request","PtabModel","data","Object","keys","key","includes","Date","PtabManager","params","constructor","applyDefaultQuery","iteratorIndex","pages","pageNumber","get","url","endpoint","qs","offset","json","page","Math","floor","index","getPage","modelClass","results","manager","filter","next","String","trialNumber","PtabTrial","documents","PtabDocument","objects","PtabTrialManager","trial","PtabDocumentManager","module","exports"],"mappings":"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","sourcesContent":["require(\"@babel/polyfill\");\nconst request = require('request-promise-native');\n\nclass PtabModel {\n    constructor(data) {\n        for (var key of Object.keys(data)) {\n            this[key] = (key.includes(\"Date\") ? new Date(data[key]) : data[key]);\n        }\n    }\n}\n\nclass PtabManager {\n    constructor(params) {\n        this.params = this.constructor.applyDefaultQuery(params);\n        this.iteratorIndex = 0;\n        this.pages = {};\n    }\n\n    filter(params) {\n        return this.constructor({...this.params, ...this.constructor.applyDefaultQuery(params)})\n    }\n\n    static applyDefaultQuery(params) {\n        if (typeof params === 'string' || params instanceof String) {\n            params = {trialNumber: params}\n        } \n        return params\n    }\n\n    async getPage(pageNumber) {\n        if (!(pageNumber in this.pages)) {\n            let page = await request.get({\n                url: \"https://ptabdata.uspto.gov/ptab-api/\" + this.endpoint,\n                qs:  {...this.params, ...{offset: pageNumber * 25}},\n                json: true,\n            })\n            this.pages[pageNumber] = page\n        }\n        return this.pages[pageNumber]\n    }\n\n    async next() {\n        let pageNumber = Math.floor(this.iteratorIndex / 25);\n        let index = this.iteratorIndex % 25;\n        this.iteratorIndex++\n        let page = await this.getPage(pageNumber);\n        return new this.modelClass(page.results[index]);\n    }\n\n    async get(params) {\n        let manager = this.filter(params);\n        return await manager.next();\n    }\n}\n\nclass PtabTrial extends PtabModel {\n    constructor(params){\n        super(params)\n        this.documents = PtabDocument.objects.filter(this.trialNumber)\n    }\n};\n\nclass PtabTrialManager extends PtabManager {\n    defaultQuery = \"trialNumber\"\n    endpoint = \"trials\"\n    modelClass = PtabTrial\n}\n\nclass PtabDocument extends PtabModel {\n    constructor(params){\n        super(params)\n        this.trial = PtabDocument.objects.filter(this.trialNumber)\n    }\n};\n\nclass PtabDocumentManager extends PtabManager {\n    defaultQuery = \"trialNumber\"\n    endpoint = \"documents\"\n    modelClass = PtabDocument\n}\nPtabTrial.objects = new PtabTrialManager({})\nPtabDocument.objects = new PtabDocumentManager({})\n\nmodule.exports = {\n    PtabTrial: PtabTrial,\n    PtabDocument: PtabDocument,\n}"],"file":"ptab.js"}